<div class="container mt-4">
  <h2 class="mb-4 text-primary fw-bold">Gestión de Órdenes</h2>

  <!-- Nueva / Editar Orden -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="mb-3">{{ editingOrderId ? 'Editar Orden' : 'Nueva Orden' }}</h4>

      <!-- Persona -->
      <div class="mb-3">
        <label for="persona" class="form-label">Persona</label>
        <select id="persona" class="form-select" [(ngModel)]="selectedPerson">
          <option [ngValue]="null">-- Seleccione una persona --</option>
          <option *ngFor="let p of persons" [ngValue]="p.id">
            {{ p.fullName }}
          </option>
        </select>
      </div>

      <!-- Item -->
      <div class="mb-3">
        <label for="item" class="form-label">Item</label>
        <select id="item" class="form-select" [(ngModel)]="selectedItem">
          <option [ngValue]="null">-- Seleccione un item --</option>
          <option *ngFor="let i of items" [ngValue]="i.id">
            {{ i.name }} - Q{{ i.price }}
          </option>
        </select>
      </div>

      <!-- Cantidad -->
      <div class="mb-3">
        <label for="cantidad" class="form-label">Cantidad</label>
        <input id="cantidad" type="number" class="form-control" [(ngModel)]="quantity" min="1">
      </div>

      <!-- Botón Agregar -->
      <button class="btn btn-primary" (click)="addItem()">
        <i class="bi bi-plus-circle"></i> Agregar Item
      </button>
    </div>
  </div>

  <!-- Detalles de la orden -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="mb-3">Detalles de la orden</h4>

      <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
          <tr>
            <th>Item</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of orderDetails">
            <td>{{ getItemName(d.itemId) }}</td>
            <td>{{ d.quantity }}</td>
            <td>Q{{ d.price }}</td>
            <td>Q{{ d.price * d.quantity }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Guardar / Actualizar -->
      <button class="btn btn-success" (click)="saveOrder()">
        <i class="bi" [ngClass]="editingOrderId ? 'bi-pencil' : 'bi-save'"></i>
        {{ editingOrderId ? 'Actualizar Orden' : 'Guardar Orden' }}
      </button>
    </div>
  </div>
</div>
